<!doctype html>
<html lang="en">
<meta http-equiv="Content-Type"
	content="multipart/form-data; charset=utf-8">
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
<head>

<title>导调服务端 --v1.0</title>
<link rel="stylesheet" type="text/css" media="all" href="${CPATH}/frame/layui/css/layui.css">
<link rel="stylesheet" type="text/css" href="${CPATH}/css/font/iconfont.css" media="all">
<link rel="stylesheet" href="${CPATH}/css/main1119.css"/>
<link rel="stylesheet" type="text/css" media="all" href="${CPATH}/css/main.css">

<script type="text/javascript">
	ctx = '${CPATH}';
	cty = '127.0.0.1:8088/${BPATH}';
</script>
<style type="text/css">  
	html{height:100%}  
	body{height:100%;margin:0px;padding:0px}  
	#container{height:100%}
	.amap-logo{display: none!important;}
	.amap-copyright{display: none!important;}
</style>  
</head>
<body style="background-color: #E9ECF1 !important">
  	<div id="container"></div>
	<script type="text/javascript" src="${CPATH}/plus/jquery-1.12.4.min.js"></script>
	<script type="text/javascript" src="${CPATH}/plus/toastr/toastr.min.js"></script>
	<script type="text/javascript" src="${CPATH}/frame/layui/layui.js"></script>
	<script type="text/javascript" src="${CPATH}/js/main1.js"></script>

    <script src="http://webapi.amap.com/maps?v=1.4.3&key=26ecc95817c92712831cb73b1c84ccb5"></script>
    <script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>
	
	<script type="text/javascript">

        var lines = new Array();
        var tags = new Array();
        var ta = 0;
        var a = 0;
		
		var map = new AMap.Map('container', {
            /*layers: [new AMap.TileLayer.Satellite({zIndex:10})],
            zoom: 13,*/
            /*resizeEnable: true,
            rotateEnable:true,
            pitchEnable:true,
            zoom: 17,
            pitch:80,
            rotation:-15,
            viewMode:'3D',//开启3D视图,默认为关闭
            buildingAnimation:true,//楼块出现是否带动画

            expandZoomRange:true,
            zooms:[3,20],
            center: [106.545474,29.601621]*/


            layers: [new AMap.TileLayer.Satellite({zIndex:10})],
            zoom: 13,
            center: [106.545474,29.601621]
	    });

        init();
		/*点击li的出发事件*/
        $('#left-menu > div > ul > li', parent.document).click(function(){
            clearLineAndTag();
            var points = $(this).find(".points").val();
            var coord = $(this).find(".coord");
            var wname = $(this).find(".wname");
            console.log(coord);
            creadController(points);
            creatTagController(coord,wname);

            
        });

        function creatTagController(coord,wname) {

			for(var tag = 0;tag<coord.length;tag++){
			    var coordStr = $(coord[tag]).val();
                if(coordStr ===''){

                }else {
                    var tagStrs = coordStr.split(",");
                    var x = tagStrs[0];
                    var y = tagStrs[1];
                    var wnameStr = $(wname[tag]).text();
                    creatTag(x,y,wnameStr);
                }
			}
        }
        var infoWindow = new AMap.InfoWindow({offset: new AMap.Pixel(0, -30)});
        /*信息框*/
        function infoWindowOpen(e) {
            infoWindow.setContent(e.target.content);
            infoWindow.open(map, e.target.getPosition());
        }
        /*关闭*/
        function infoWindowClose(e) {
            map.clearInfoWindow();
        }
		/*在地图上标记点*/
        function creatTag(x, y,wname) {
            marker = new AMap.Marker({
//                icon: "http://lbsyun.baidu.com/jsdemo/img/fox.gif",
                icon: "http://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",
                position: [x, y]
            });
            marker.content = wname;
            marker.on('mouseover', infoWindowOpen);
            marker.on('mouseout', infoWindowClose);
            marker.on('click', markerClick);
//            marker.emit('click', {target: marker});
            tags[ta] = marker;
            ta++;
            marker.setMap(map);
            map.setFitView();
        }

        /*点击标记事件*/
        function markerClick() {
			alert("你点击了。。。还没开始挖……")
        }

        //点击地图空白地方，清除所有的弹出窗体
        AMap.event.addListener(map, 'click', function (e) {
            map.clearInfoWindow();
        });
        /*初始化lu线*/
		function init() {
			console.log("init");
           var li = window.parent.document.getElementsByClassName("layui-nav-itemed")[0];
            console.log("--------------="+li)
            console.log(li)
           var points = $(li).find(".points").val();
           var coord = $(li).find(".coord");
            var wname = $(li).find(".wname");

            creadController(points);
            creatTagController(coord,wname);
        }

        /*绘制路线*/
        function creadController(points) {
            var lineStr = new Array();
            lineStr = points.split("#");

            var items = new Array();
            for(var j = 0;j<lineStr.length;j++){

                var str = lineStr[j].split(",");
                var x = str[0];
                var y = str[1];
                items[j]= [x,y];
            }
            creatLine(items,"init");
        }


		/*线的样式*/
        function creatLine(points,init) {
            console.log(points);
            var polyline = new AMap.Polyline({
                path: points,          //设置线覆盖物路径
                strokeColor: "#6cff0e", //线颜色
                strokeOpacity: 1,       //线透明度
                strokeWeight: 5,        //线宽
                strokeStyle: "solid",   //线样式
                strokeDasharray: [10, 5] //补充线样式
            });
            console.log("-----"+polyline)
            console.log(polyline)
//            if(init != 'init'){
            lines[a] = polyline;
            a++
//            }
			console.log(polyline);
            polyline.setMap(map);

        }
        /*清除线点*/
        function clearLineAndTag() {
			map.remove(lines);
			map.remove(tags);
			ta = 0;
			a = 0;
			lines.splice(0,lines.length);
            tags.splice(0,tags.length);
        }
		/*var roadNet = new AMap.TileLayer.RoadNet({zIndex:10});
		roadNet.setMap(map);
		var lineArr = [
            [106.55562,29.60744],
            [106.555624,29.606738],
            [106.555615,29.606724],
            [106.555571,29.606182],
            [106.55531,29.605499],
            [106.554376,29.604997],
            [106.55063,29.604989],
            [106.548645,29.605154],
            [106.542051,29.606284]
        ];
        var polyline = new AMap.Polyline({
            path: lineArr,          //设置线覆盖物路径
            strokeColor: "#3366FF", //线颜色
            strokeOpacity: 1,       //线透明度
            strokeWeight: 5,        //线宽
            strokeStyle: "solid",   //线样式
            strokeDasharray: [10, 5] //补充线样式
        });
        polyline.setMap(map);*/
	</script>  
</body>
</html>