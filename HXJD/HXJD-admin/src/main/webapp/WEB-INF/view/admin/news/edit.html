<#include "../../_include/_layout.inc.tag"/> 
<@layout active_id="dashboard">
<form class="layui-form" id="form" action="" style="margin: 10px 10px 0px 10px;height: 100%;overflow-y: auto" enctype="multipart/form-data" method="post">
  <input type="hidden" name="jNews.id" value="${news.id!}">
  <div class="layui-form-item">
    <label class="layui-form-label">标题</label>
    <div class="layui-input-inline" style="width:40%;">
      <input type="text" name="jNews.title" value="${news.title!}" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">内容</label>
    <div class="layui-input-inline" style="width:40%; height:50%;">
      <textarea name="jNews.content" id="content" required  lay-verify="required" placeholder="请输入内容" class="layui-textarea">${news.content!}</textarea>     
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">类型</label>
    <div class="layui-input-inline" style="width:40%;">
      <select name="jNews.type" lay-verify="" required  lay-verify="required">
      	<#if type??>		
    		<#list type as bean>
    			<option value="${bean.id!}" <#if bean.id=news.type>selected</#if>>${bean.name!}</option>   
    		</#list>    	
    	</#if>
      </select>	
    </div>
  </div>
    <div class="layui-form-item">
    <label class="layui-form-label">附件</label>
    <div class="layui-input-inline" style="width:40%;">
      <input type="file" id="attachment" name="attachment">
    </div>
  </div>
  <div class="layui-form-item">
    <div class="layui-input-block">
      <button class="layui-btn" lay-submit lay-filter="formDemo">立即提交</button>
      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
    </div>
  </div>
</form>
<!-- ///HXJD-web/src/main/webapp/common/plus/kindeditor/kindeditor-all-min.js -->
<script charset="utf-8" src="${CPATH}/plus/kindeditor/kindeditor-all-min.js"></script>
<script charset="utf-8" src="${CPATH}/plus/kindeditor/lang/zh-CN.js"></script>
<script charset="utf-8" src="${CPATH}/js/initKindeditor.js"></script>
<script>
	layui.use(['form','common'], function() {
		var form = layui.form,
			common = layui.common;
		common.formAjaxSubmit('formDemo','form',bpath+'/admin/news/editSave');
		form.render();
		
		var editor = null;
		editor = KindEditor;
		editor.create('#content',{
            items:KindeditorOption.items,
            cssPath : '${CPATH}/plus/kindeditor/plugins/code/prettify.css',
			uploadJson : '${CPATH}/plus/kindeditor/jsp/upload_json.jsp',
			fileManagerJson : '${CPATH}/plus/kindeditor/jsp/file_manager_json.jsp',
			width:'100%',
			height:'450px',
			resizeType: 0,
			autoHeightMode : false,
			allowFileManager : true,
			afterBlur: function(){this.sync();}
		});

        /**
         * 判断类型
         */
        var newsType="${news.type!}";
        $(function () {
            var type=parent.type;
            if(type!=null&&type!=""&&type!="-1"){
                $("select").find("option[value!="+type+"]").remove();
                form.render();
            }else{
                //说明是其他信息类型
                $.ajax({
                    url:'${BPATH}/admin/news/getCommonNewsType',
                    type:"get",
                    dataType:"json",
                    success:function (result) {
                        console.log(result);
                        if(result.errorCode==0){
                            $("select").empty();
                            result.data.forEach(function (val, index) {
                                if(val.id==newsType){
                                    $("select").append("<option value=\""+val.id+"\" selected>"+val.name+"</option>");
                                }else{
                                    $("select").append("<option value=\""+val.id+"\">"+val.name+"</option>");
                                }
                            });
                        }
                        form.render();
                    },
                    error:function (result) {

                    }
                });
            }
        });
	});
	
</script>
</@layout>